{
  "hash": "a35863b5962a112ade3f321dac2d090b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"02_D_beta-countries\"\nsubtitle: \"Analysis of mismatch between country native composition and primary type data\"\nformat: html\neval: FALSE\n---\n\n\n# Reading packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data\nlibrary(readr)        # reading CSV files\nlibrary(here)         # constructing file paths\nlibrary(dplyr)        # data manipulation\nlibrary(tidyr)        # data tidying\nlibrary(phyloregion)  # handling phylogenetic data and transformations\n```\n:::\n\n\n# Importing and processing data \n\nImporting and processing native composition and NBT composition data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# From 01_C_data_preparation.qmd\nspp_native_distribution <- readr::read_csv(here::here(\"data\", \"processed\", \"spp_native_distribution.csv\")) \n\n# From 01_C_data_preparation.qmd\nspp_type_distribution <- readr::read_csv(here::here(\"data\", \"processed\", \"spp_type_distribution.csv\")) \n```\n:::\n\n\nChecking the specimens with data in both tables (native distribution and types). We transformed the long format species occurrence data frame to dense format. During this procedure we removed 1204 species that do not have information on native distribution (or we couldn't get this information from CAS)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_native_grid <- \n  spp_native_distribution |> \n  dplyr::select(grids = country_distribution, \n                species = valid_name) |> \n  tidyr::drop_na(grids)\n\ndf_type_grid <- \n  spp_type_distribution |> \n  dplyr::select(grids = country_museum, \n                species = valid_name) |> \n  tidyr::drop_na(grids) |> \n  dplyr::mutate(grids = paste(grids, \"type\", sep = \"_\"))\n  \n\n# joining data frames\ndf_all_grid <- rbind(df_native_grid, df_type_grid) # joining both matrices - \n    #native and types composition\n\n#### Just descriptive quantities\ncountry_native <- unique(df_native_grid$grids)\ncountry_type <- gsub(pattern = \"_type\", \n                     replacement = \"\",\n                     unique(df_type_grid$grids))\ncountry_type_zero <- setdiff(country_native, country_type) # countries with no type specimen\n\n# transforming into a sparse matrix to speed up calculations\nsparse_all <- df_all_grid |> \n  phyloregion::long2sparse(grids = \"grids\", species = \"species\") |> \n  phyloregion::sparse2dense()\n\n# Transforming in presence absence matrix\nsparse_all_pa <- ifelse(sparse_all >= 1, 1, 0) \n\n# Binding countries with no types - adding zeroes\ncountry_type_zero_names <- paste(country_type_zero, \"_type\", sep = \"\") # this will be used to bind together matrix with types and add the countries with no type\nmatrix_type_zero <- matrix(0,\n         nrow = length(country_type_zero_names),\n         ncol = ncol(sparse_all_pa), \n         dimnames = list(country_type_zero_names, \n                         colnames(sparse_all_pa)))\n\nsparse_all_pa2 <- rbind(sparse_all_pa, matrix_type_zero)\n```\n:::\n\n\n# Calculating directional turnover based on native and primary type comparison\n\nHere we calculated the turnover in two directions. One is the turnover of native composition, in other words, the underrepresentation of native fish species in museums and natural collections within the country. Values closer to one indicate that the country present a huge underepresentation of its native fish fauna in primary types located within the country. \n\nThe other metric is primary type turnover. Values approaching one indicate that there is an overepresentation of primary types maintained in the country when compared to the native fish fauna of that country.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"R\", \"function_beta_types.R\"))\n\nnames_countries <- unique(df_native_grid$grids) # country names\n\ndf_all_beta <- beta_types(presab = sparse_all_pa2, \n                          names.countries = names_countries) # calculating metrics of directional turnover\n\nreadr::write_csv(df_all_beta, here::here(\"data\", \"processed\", \"df_all_beta.csv\"))\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}